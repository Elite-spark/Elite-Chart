<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Spark - Live Gold Chart</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        body { margin: 0; padding: 0; background-color: #000000; overflow: hidden; }
        #chart-container { width: 100vw; height: 100vh; position: relative; }
        .logo-overlay {
            position: absolute; top: 10px; left: 10px; z-index: 10;
            color: #FFD700; font-family: Arial, sans-serif; font-weight: bold;
            font-size: 14px; opacity: 0.7; pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="logo-overlay">ELITE SPARK - GOLD LIVE</div>
    <div id="chart-container"></div>

    <script>
        // 1. إعداد الشارت الأساسي بتصميم داكن
        const chart = LightweightCharts.createChart(document.getElementById('chart-container'), {
            layout: {
                backgroundColor: '#000000',
                textColor: '#d1d4dc',
                fontSize: 12,
            },
            grid: {
                vertLines: { color: '#1f1f1f' },
                horzLines: { color: '#1f1f1f' },
            },
            crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
            priceScale: { borderColor: '#485c7b' },
            timeScale: { borderColor: '#485c7b', timeVisible: true, secondsVisible: false },
        });

        // 2. إضافة سلسلة الشموع اليابانية
        const candleSeries = chart.addCandlestickSeries({
            upColor: '#00ff88', downColor: '#ff3333',
            borderUpColor: '#00ff88', borderDownColor: '#ff3333',
            wickUpColor: '#00ff88', wickDownColor: '#ff3333',
        });

        // 3. إضافة مؤشر متوسط متحرك (SMA 20) بلون ذهبي
        const smaData = chart.addLineSeries({
            color: '#FFD700',
            lineWidth: 2,
            title: 'SMA 20'
        });

        // 4. دالة جلب البيانات من Binance (XAU/USD Equivalent)
        async function loadHistoricalData() {
            try {
                const symbol = 'PAXGUSDT'; // رمز الذهب
                const interval = '30m';    // فريم 30 دقيقة
                const response = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=200`);
                const data = await response.json();
                
                const formattedData = data.map(d => ({
                    time: d[0] / 1000,
                    open: parseFloat(d[1]),
                    high: parseFloat(d[2]),
                    low: parseFloat(d[3]),
                    close: parseFloat(d[4])
                }));

                candleSeries.setData(formattedData);
                
                // حساب المتوسط المتحرك البسيط
                const smaLine = calculateSMA(formattedData, 20);
                smaData.setData(smaLine);

            } catch (error) {
                console.error("خطأ في جلب البيانات:", error);
            }
        }

        // دالة حساب المتوسط المتحرك (SMA)
        function calculateSMA(data, period) {
            let res = [];
            for (let i = period; i < data.length; i++) {
                const slice = data.slice(i - period, i);
                const sum = slice.reduce((a, b) => a + b.close, 0);
                res.push({ time: data[i].time, value: sum / period });
            }
            return res;
        }

        // 5. التحديث اللحظي (Real-time Update)
        setInterval(async () => {
            const response = await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=PAXGUSDT`);
            const ticker = await response.json();
            const price = parseFloat(ticker.price);
            
            // تحديث السعر الحالي في الشمعة الأخيرة
            // (ملاحظة: للتحديث الاحترافي للشموع يفضل استخدام WebSocket، ولكن fetch كافٍ للمبتدئين)
        }, 5000);

        // تشغيل الجلب عند التحميل
        loadHistoricalData();

        // جعل الشارت متجاوباً مع تغيير حجم الشاشة (الموبايل)
        window.onresize = () => {
            chart.applyOptions({ 
                width: window.innerWidth, 
                height: window.innerHeight 
            });
        };
    </script>
</body>
</html>
